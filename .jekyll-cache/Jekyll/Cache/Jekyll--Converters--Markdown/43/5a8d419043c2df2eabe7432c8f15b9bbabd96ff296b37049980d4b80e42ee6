I"ÌJ<p><a href="http://clintonbrennan.com/2014/04/lockstep-implementation-in-unity3d-part-2/">Lockstep Implementation in Unity3D â€“ Part 2</a></p>

<h3 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h3>

<p>åœ¨ä¸Šæ¬¡å®ç°çš„å¸§åŒæ­¥æ¨¡å‹å½“ä¸­ï¼Œæ¸¸æˆå¸§ç‡å’Œé€šä¿¡é¢‘ç‡(ä¹Ÿå°±æ˜¯å¸§åŒæ­¥é•¿åº¦)é•¿åº¦æ˜¯å›ºå®šé—´éš”çš„ã€‚ä½†å®é™…ä¸Šï¼Œæ¯ä¸ªç©å®¶çš„å»¶è¿Ÿå’Œæ€§èƒ½éƒ½ä¸åŒçš„ã€‚åœ¨updateä¸­ä¼šè·Ÿè¸ªä¸¤ä¸ªå˜é‡ã€‚ç¬¬ä¸€ä¸ªæ˜¯ç©å®¶é€šä¿¡çš„æ—¶é•¿ã€‚ç¬¬äºŒä¸ªåˆ™æ˜¯æ¸¸æˆçš„æ€§èƒ½æ—¶é•¿ã€‚</p>

<h3 id="ç§»åŠ¨å¹³å‡æ•°">ç§»åŠ¨å¹³å‡æ•°</h3>

<p>ä¸ºäº†å¤„ç†å»¶è¿Ÿä¸Šçš„æ³¢åŠ¨ï¼Œæˆ‘ä»¬æƒ³å¿«é€Ÿå¢åŠ å¸§åŒæ­¥å›åˆçš„æ—¶é•¿ï¼ŒåŒæ—¶ä¹Ÿæƒ³åœ¨ä½å»¶è¿Ÿçš„æ—¶å€™å‡å°‘ã€‚å¦‚æœæ¸¸æˆæ›´æ–°çš„èŠ‚å¥èƒ½å¤Ÿæ ¹æ®å»¶è¿Ÿçš„æµ‹é‡ç»“æœè‡ªåŠ¨è°ƒèŠ‚ï¼Œè€Œä¸æ˜¯å›ºå®šå€¼çš„è¯ï¼Œä¼šä½¿å¾—æ¸¸æˆç©èµ·æ¥æ›´åŠ é¡ºç•…ã€‚æˆ‘ä»¬å¯ä»¥ç´¯åŠ æ‰€æœ‰çš„è¿‡å»ä¿¡æ¯å¾—åˆ°â€ç§»åŠ¨å¹³å‡æ•°â€ï¼Œç„¶åæ ¹æ®å®ƒä½œä¸ºè°ƒèŠ‚çš„æƒé‡ã€‚</p>

<p>æ¯å½“ä¸€ä¸ªæ–°å€¼å¤§äºå¹³å‡æ•°ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®å¹³å‡æ•°ä¸ºæ–°å€¼ã€‚è¿™ä¼šå¾—åˆ°å¿«é€Ÿå¢åŠ å»¶è¿Ÿçš„è¡Œä¸ºã€‚å½“å€¼å°äºå½“å‰å¹³å‡å€¼ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æƒé‡å¤„ç†è¯¥å€¼ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å…¬å¼ï¼š</p>

\[newAverage = currentAverage * (1 â€“ w) + newValue * ( w)\]

<p>å…¶ä¸­0&lt;w&lt;1</p>

<p>åœ¨æˆ‘çš„å®ç°ä¸­ï¼Œæˆ‘è®¾ç½®w=0.1ã€‚è€Œä¸”è¿˜ä¼šè·Ÿè¸ªæ¯ä¸ªç©å®¶çš„å¹³å‡æ•°ï¼Œè€Œä¸”æ€»æ˜¯ä½¿ç”¨æ‰€æœ‰ç©å®¶å½“ä¸­çš„æœ€å¤§å€¼ã€‚è¿™é‡Œæ˜¯å¢åŠ æ–°å€¼çš„æ–¹æ³•ï¼š</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">public</span> <span class="kt">void</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">newValue</span><span class="p">,</span> <span class="kt">int</span> <span class="n">playerID</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">newValue</span> <span class="o">&gt;</span> <span class="n">playerAverages</span><span class="p">[</span><span class="n">playerID</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">//rise quickly</span>

        <span class="n">playerAverages</span><span class="p">[</span><span class="n">playerID</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">//slowly fall down</span>

        <span class="n">playerAverages</span><span class="p">[</span><span class="n">playerID</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">playerAverages</span><span class="p">[</span><span class="n">playerID</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="n">newValue</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>ä¸ºäº†ä¿è¯è®¡ç®—ç»“æœçš„ç¡®å®šæ€§ï¼Œè®¡ç®—åªä½¿ç”¨æ•´æ•°ã€‚å› æ­¤å…¬å¼è°ƒæ•´å¦‚ä¸‹ï¼š</p>

\[newAverage = (currentAverage * (10 â€“ w) + newValue * ( w)) / 10\]

<p>å…¶ä¸­0&lt;w&lt;1</p>

<p>è€Œåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œw=1ã€‚</p>

<h3 id="è¿è¡Œæ—¶é—´å¹³å‡æ•°">è¿è¡Œæ—¶é—´å¹³å‡æ•°</h3>

<p>æ¯æ¬¡æ¸¸æˆå¸§æ›´æ–°çš„æ—¶é—´æ˜¯ç”±è¿è¡Œæ—¶é—´å¹³å‡æ•°å†³å®šçš„ã€‚å¦‚æœæ¸¸æˆå¸§è¦å˜å¾—æ›´é•¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é™ä½æ¯æ¬¡å¸§åŒæ­¥å›åˆæ›´æ–°æ¸¸æˆå¸§çš„æ¬¡æ•°ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ¸¸æˆå¸§æ‰§è¡Œå¾—æ›´å¿«äº†ï¼Œæ¯æ¬¡å¸§åŒæ­¥å›åˆå¯ä»¥æ›´æ–°æ¸¸æˆå¸§çš„æ¬¡æ•°ä¹Ÿå¤šäº†ã€‚å¯¹äºæ¯æ¬¡å¸§åŒæ­¥å›åˆï¼Œæœ€é•¿çš„æ¸¸æˆå¸§ä¼šè¢«æ·»åŠ åˆ°å¹³å‡æ•°ä¸­ã€‚æ¯æ¬¡å¸§åŒæ­¥å›åˆçš„ç¬¬ä¸€ä¸ªæ¸¸æˆå¸§éƒ½åŒ…å«äº†å¤„ç†åŠ¨ä½œçš„æ—¶é—´ã€‚è¿™é‡Œä½¿ç”¨Stopwatchæ¥è®¡ç®—æµé€çš„æ—¶é—´ã€‚</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">private</span> <span class="kt">void</span> <span class="nf">ProcessActions</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//process action should be considered in runtime performance</span>

    <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">Start</span> <span class="p">();</span>
 
    <span class="p">...</span>
 
    <span class="c1">//finished processing actions for this turn, stop the stopwatch</span>

    <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">Stop</span> <span class="p">();</span>
<span class="p">}</span>
 
<span class="k">private</span> <span class="kt">void</span> <span class="nf">GameFrameTurn</span><span class="p">()</span> <span class="p">{</span>
   <span class="p">...</span>
         
    <span class="c1">//start the stop watch to determine game frame runtime performance</span>

    <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
 
    <span class="c1">//update game</span>

    <span class="p">...</span>
 
    <span class="n">GameFrame</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">GameFrame</span> <span class="o">==</span> <span class="n">GameFramesPerLockstepTurn</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">GameFrame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="c1">//stop the stop watch, the gameframe turn is over</span>

    <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">Stop</span> <span class="p">();</span>
    <span class="c1">//update only if it's larger - we will use the game frame that took the longest in this lockstep turn</span>

    <span class="kt">long</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToInt32</span> <span class="p">((</span><span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span><span class="cm">/*deltaTime is in secounds, convert to milliseconds*/</span> <span class="o">+</span> <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">runtime</span> <span class="o">&gt;</span> <span class="n">currentGameFrameRuntime</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentGameFrameRuntime</span> <span class="o">=</span> <span class="n">runtime</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="c1">//clear for the next frame</span>

    <span class="n">gameTurnSW</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>æ³¨æ„åˆ°æˆ‘ä»¬ä¹Ÿç”¨åˆ°äº†Time.deltaTimeã€‚ä½¿ç”¨è¿™ä¸ªå¯èƒ½ä¼šåœ¨æ¸¸æˆä»¥å›ºå®šå¸§ç‡æ‰§è¡Œçš„æƒ…å†µä¸‹ä¸ä¸Šä¸€å¸§æ—¶é—´é‡å ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°å®ƒï¼Œè¿™ä½¿å¾—Unityä¸ºæˆ‘ä»¬æ‰€åšçš„æ¸²æŸ“ä»¥åŠå…¶ä»–äº‹æƒ…éƒ½æ˜¯å¯æµ‹é‡çš„ã€‚è¿™ä¸ªé‡å æ˜¯å¯æ¥å—çš„ï¼Œå› ä¸ºåªæ˜¯éœ€è¦æ›´å¤§çš„ç¼“å†²åŒºè€Œå·²ã€‚</p>

<h3 id="ç½‘ç»œå¹³å‡æ•°">ç½‘ç»œå¹³å‡æ•°</h3>

<p>æ‹¿ä»€ä¹ˆä½œä¸ºç½‘ç»œå¹³å‡æ•°åœ¨è¿™é‡Œä¸å¤ªæ˜ç¡®ã€‚æˆ‘æœ€ç»ˆä½¿ç”¨äº†Stopwatchè®¡ç®—ä»ç©å®¶å‘é€æ•°æ®åŒ…åˆ°ç©å®¶ç¡®è®¤åŠ¨ä½œçš„æ—¶é—´ã€‚è¿™ä¸ªå¸§åŒæ­¥æ¨¡å‹å‘é€çš„åŠ¨ä½œä¼šåœ¨æœªæ¥ä¸¤ä¸ªå›åˆä¸­æ‰§è¡Œã€‚ä¸ºäº†ç»“æŸå¸§åŒæ­¥å›åˆï¼Œæˆ‘ä»¬éœ€è¦æ‰€æœ‰ç©å®¶éƒ½ç¡®è®¤äº†è¿™ä¸ªåŠ¨ä½œã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªåŠ¨ä½œç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨åˆ°äº†ä¸¤ä¸ªStopwatchã€‚ä¸€ä¸ªç”¨äºå½“å‰åŠ¨ä½œï¼Œå¦ä¸€ä¸ªç”¨äºä¸Šä¸€ä¸ªåŠ¨ä½œã€‚è¿™è¢«å°è£…åœ¨ConfirmActionsç±»å½“ä¸­ã€‚å½“å¸§åŒæ­¥å›åˆå¾€ä¸‹èµ°ï¼Œä¸Šä¸€ä¸ªåŠ¨ä½œçš„Stopwatchä¼šæˆä¸ºè¿™ä¸€ä¸ªåŠ¨ä½œçš„Stopwatchï¼Œè€Œæ—§çš„â€å½“å‰åŠ¨ä½œStopwatchâ€ä¼šè¢«å¤ç”¨ä½œä¸ºæ–°çš„â€ä¸Šä¸€ä¸ªåŠ¨ä½œStopwatchâ€ã€‚</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">public</span> <span class="k">class</span> <span class="nc">ConfirmedActions</span>
<span class="p">{</span>
<span class="p">...</span>
    <span class="k">public</span> <span class="kt">void</span> <span class="n">NextTurn</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">Stopwatch</span> <span class="n">swapSW</span> <span class="o">=</span> <span class="n">priorSW</span><span class="p">;</span>
             
        <span class="c1">//last turns actions is now this turns prior actions</span>

        <span class="p">...</span>
        <span class="n">priorSW</span> <span class="o">=</span> <span class="n">currentSW</span><span class="p">;</span>
         
        <span class="c1">//set this turns confirmation actions to the empty array</span>

        <span class="p">...</span>
        <span class="n">currentSW</span> <span class="o">=</span> <span class="n">swapSW</span><span class="p">;</span>
        <span class="n">currentSW</span><span class="p">.</span><span class="n">Reset</span> <span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>æ¯å½“æœ‰ç¡®è®¤è¿›æ¥ï¼Œæˆ‘ä»¬ä¼šç¡®è®¤æˆ‘ä»¬æ¥æ”¶äº†æ‰€æœ‰çš„ç¡®è®¤ï¼Œå¦‚æœæ¥æ”¶åˆ°äº†ï¼Œé‚£ä¹ˆå°±æš‚åœStopwatchã€‚</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">public</span> <span class="kt">void</span> <span class="nf">ConfirmAction</span><span class="p">(</span><span class="kt">int</span> <span class="n">confirmingPlayerID</span><span class="p">,</span> <span class="kt">int</span> <span class="n">currentLockStepTurn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">confirmedActionLockStepTurn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">confirmedActionLockStepTurn</span> <span class="o">==</span> <span class="n">currentLockStepTurn</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//if current turn, add to the current Turn Confirmation</span>

        <span class="n">confirmedCurrent</span><span class="p">[</span><span class="n">confirmingPlayerID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">confirmedCurrentCount</span><span class="o">++</span><span class="p">;</span>
        <span class="c1">//if we recieved the last confirmation, stop timer</span>

        <span class="c1">//this gives us the length of the longest roundtrip message</span>

        <span class="k">if</span><span class="p">(</span><span class="n">confirmedCurrentCount</span> <span class="o">==</span> <span class="n">lsm</span><span class="p">.</span><span class="n">numberOfPlayers</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentSW</span><span class="p">.</span><span class="n">Stop</span> <span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">confirmedActionLockStepTurn</span> <span class="o">==</span> <span class="n">currentLockStepTurn</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//if confirmation for prior turn, add to the prior turn confirmation</span>

        <span class="n">confirmedPrior</span><span class="p">[</span><span class="n">confirmingPlayerID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">confirmedPriorCount</span><span class="o">++</span><span class="p">;</span>
        <span class="c1">//if we recieved the last confirmation, stop timer</span>

        <span class="c1">//this gives us the length of the longest roundtrip message</span>

        <span class="k">if</span><span class="p">(</span><span class="n">confirmedPriorCount</span> <span class="o">==</span> <span class="n">lsm</span><span class="p">.</span><span class="n">numberOfPlayers</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">priorSW</span><span class="p">.</span><span class="n">Stop</span> <span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">//TODO: Error Handling</span>

        <span class="n">log</span><span class="p">.</span><span class="n">Debug</span> <span class="p">(</span><span class="s">"WARNING!!!! Unexpected lockstepID Confirmed : "</span> <span class="o">+</span> <span class="n">confirmedActionLockStepTurn</span> <span class="o">+</span> <span class="s">" from player: "</span> <span class="o">+</span> <span class="n">confirmingPlayerID</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h3 id="å‘é€å¹³å‡æ•°">å‘é€å¹³å‡æ•°</h3>

<p>ä¸ºäº†è®©ä¸€ä¸ªå®¢æˆ·ç«¯å‘å…¶ä»–å®¢æˆ·ç«¯å‘é€å¹³å‡æ•°ï¼ŒActionæ¥å£ä¿®æ”¹ä¸ºä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—æ®µçš„æŠ½è±¡ç±»ã€‚</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Action</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">NetworkAverage</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="n">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">RuntimeAverage</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="n">set</span><span class="p">;</span> <span class="p">}</span>
 
    <span class="k">public</span> <span class="k">virtual</span> <span class="kt">void</span> <span class="n">ProcessAction</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></figure>

<p>æ¯å½“å¤„ç†åŠ¨ä½œï¼Œè¿™äº›æ•°å­—ä¼šåŠ åˆ°è¿è¡Œå¹³å‡æ•°ã€‚ç„¶åå¸§åŒæ­¥å›åˆä»¥åŠæ¸¸æˆå¸§å›åˆå¼€å§‹æ›´æ–°</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">private</span> <span class="kt">void</span> <span class="nf">UpdateGameFrameRate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//log.Debug ("Runtime Average is " + runtimeAverage.GetMax ());</span>

    <span class="c1">//log.Debug ("Network Average is " + networkAverage.GetMax ());</span>

    <span class="n">LockstepTurnLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">networkAverage</span><span class="p">.</span><span class="n">GetMax</span> <span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="cm">/*two round trips*/</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="cm">/*minimum of 1 ms*/</span><span class="p">;</span>
    <span class="n">GameFrameTurnLength</span> <span class="o">=</span> <span class="n">runtimeAverage</span><span class="p">.</span><span class="n">GetMax</span> <span class="p">();</span>
 
    <span class="c1">//lockstep turn has to be at least as long as one game frame</span>

    <span class="k">if</span><span class="p">(</span><span class="n">GameFrameTurnLength</span> <span class="o">&gt;</span> <span class="n">LockstepTurnLength</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LockstepTurnLength</span> <span class="o">=</span> <span class="n">GameFrameTurnLength</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">GameFramesPerLockstepTurn</span> <span class="o">=</span> <span class="n">LockstepTurnLength</span> <span class="o">/</span> <span class="n">GameFrameTurnLength</span><span class="p">;</span>
    <span class="c1">//if gameframe turn length does not evenly divide the lockstep turn, there is extra time left after the last</span>

    <span class="c1">//game frame. Add one to the game frame turn length so it will consume it and recalculate the Lockstep turn length</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">LockstepTurnLength</span> <span class="o">%</span> <span class="n">GameFrameTurnLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">GameFrameTurnLength</span><span class="o">++</span><span class="p">;</span>
        <span class="n">LockstepTurnLength</span> <span class="o">=</span> <span class="n">GameFramesPerLockstepTurn</span> <span class="o">*</span> <span class="n">GameFrameTurnLength</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">LockstepsPerSecond</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">LockstepTurnLength</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">LockstepsPerSecond</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">LockstepsPerSecond</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//minimum per second</span>
 
    <span class="n">GameFramesPerSecond</span> <span class="o">=</span> <span class="n">LockstepsPerSecond</span> <span class="o">*</span> <span class="n">GameFramesPerLockstepTurn</span><span class="p">;</span>
 
    <span class="n">PerformanceLog</span><span class="p">.</span><span class="n">LogGameFrameRate</span><span class="p">(</span><span class="n">LockStepTurnID</span><span class="p">,</span> <span class="n">networkAverage</span><span class="p">,</span> <span class="n">runtimeAverage</span><span class="p">,</span> <span class="n">GameFramesPerSecond</span><span class="p">,</span> <span class="n">LockstepsPerSecond</span><span class="p">,</span> <span class="n">GameFramesPerLockstepTurn</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h3 id="æ›´æ–°æ”¯æŒå•ä¸ªç©å®¶">æ›´æ–°ï¼šæ”¯æŒå•ä¸ªç©å®¶</h3>

<p>è‡ªä»æœ¬æ–‡å‘å‡ºä»¥æ¥ï¼Œå¢åŠ äº†å•äººæ¨¡å¼å¾—æ”¯æŒã€‚</p>

<p>ç‰¹åˆ«æ„Ÿè°¢<a href="redstinggames.com">redstinggames.com</a>çš„Danæä¾›ã€‚å¯ä»¥åœ¨ä»¥ä¸‹çœ‹åˆ°ä¿®æ”¹ï¼š</p>

<p><a href="https://bitbucket.org/brimock/dynamic-lockstep-sample/commits/11539478537f52cbafd8cfd575ea067fdd6a9e49">Single Player Update diff</a></p>

<h3 id="æºä»£ç ">æºä»£ç </h3>

<p><a href="https://bitbucket.org/brimock/dynamic-lockstep-sample">Source code on bitbucket â€“ Dynamic Lockstep Sample</a></p>

:ET